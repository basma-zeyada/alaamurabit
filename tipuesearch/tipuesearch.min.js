!function(e){e.fn.tipuesearch=function(t){var i=e.extend({contentLocation:"tipuesearch/tipuesearch_content.json",contextBuffer:60,contextLength:60,contextStart:90,debug:!1,descriptiveWords:25,highlightTerms:!0,liveContent:"*",liveDescription:"*",minimumLength:3,mode:"static",newWindow:!1,show:9,showContext:!0,showRelated:!0,showTime:!0,showTitleCount:!0,showURL:!0,wholeWords:!0},t);return this.each(function(){var t={pages:[]};e.ajaxSetup({async:!1});var s=0;if(e("#tipue_search_content").hide().html('<div class="tipue_search_spinner"><div class="tipue_search_rect1"></div><div class="tipue_search_rect2"></div><div class="rect3"></div></div>').show(),"live"==i.mode)for(var a=0;a<tipuesearch_pages.length;a++)e.get(tipuesearch_pages[a]).done(function(s){var r=e(i.liveContent,s).text();r=r.replace(/\s+/g," ");var c=e(i.liveDescription,s).text();c=c.replace(/\s+/g," ");var n=s.toLowerCase().indexOf("<title>"),h=s.toLowerCase().indexOf("</title>",n+7);if(-1!=n&&-1!=h)var o=s.slice(n+7,h);else o=tipuesearch_string_1;t.pages.push({title:o,text:c,tags:r,url:tipuesearch_pages[a]})});"json"==i.mode&&e.getJSON(i.contentLocation).done(function(i){t=e.extend({},i)}),"static"==i.mode&&(t=e.extend({},tipuesearch));var r="";function c(e){var t=location.search,i=(new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(t)||[,""])[1].replace(/\+/g,"%20");try{i=decodeURIComponent(i)}catch(e){i=unescape(i)}return i||null}function n(a,c){var h="",o=!1,l=!1,p=!0,_=0;found=[];var u=e("#tipue_search_input").val(),d=u.toLowerCase();((d=e.trim(d)).match('^"')&&d.match('"$')||d.match("^'")&&d.match("'$"))&&(p=!1);var g=d.split(" ");if(p){d="";for(var f=0;f<g.length;f++){for(var v=!0,w=0;w<tipuesearch_stop_words.length;w++)g[f]==tipuesearch_stop_words[w]&&(v=!1,l=!0);v&&(d=d+" "+g[f])}g=(d=e.trim(d)).split(" ")}else d=d.substring(1,d.length-1);if(d.length>=i.minimumLength){if(p){if(c){var m=d;for(f=0;f<g.length;f++)for(w=0;w<tipuesearch_replace.words.length;w++)g[f]==tipuesearch_replace.words[w].word&&(d=d.replace(g[f],tipuesearch_replace.words[w].replace_with),o=!0);g=d.split(" ")}var x=d;for(f=0;f<g.length;f++)for(w=0;w<tipuesearch_stem.words.length;w++)g[f]==tipuesearch_stem.words[w].word&&(x=x+" "+tipuesearch_stem.words[w].stem);g=x.split(" ");for(f=0;f<t.pages.length;f++){var b=0,L=t.pages[f].text;for(w=0;w<g.length;w++){if(i.wholeWords)var C=new RegExp("\\b"+g[w]+"\\b","gi");else C=new RegExp(g[w],"gi");if(-1!=t.pages[f].title.search(C))b+=20*t.pages[f].title.match(C).length;if(-1!=t.pages[f].text.search(C))b+=20*t.pages[f].text.match(C).length;if(-1!=t.pages[f].tags.search(C))b+=10*t.pages[f].tags.match(C).length;if(-1!=t.pages[f].url.search(C)&&(b+=20),0!=b)for(var R=0;R<tipuesearch_weight.weight.length;R++)t.pages[f].url==tipuesearch_weight.weight[R].url&&(b+=tipuesearch_weight.weight[R].score);g[w].match("^-")&&(C=new RegExp(g[w].substring(1),"i"),-1==t.pages[f].title.search(C)&&-1==t.pages[f].text.search(C)&&-1==t.pages[f].tags.search(C)||(b=0))}0!=b&&(found.push({score:b,title:t.pages[f].title,desc:L,url:t.pages[f].url}),_++)}}else for(f=0;f<t.pages.length;f++){b=0,L=t.pages[f].text,C=new RegExp(d,"gi");if(-1!=t.pages[f].title.search(C))b+=20*t.pages[f].title.match(C).length;if(-1!=t.pages[f].text.search(C))b+=20*t.pages[f].text.match(C).length;if(-1!=t.pages[f].tags.search(C))b+=10*t.pages[f].tags.match(C).length;if(-1!=t.pages[f].url.search(C)&&(b+=20),0!=b)for(R=0;R<tipuesearch_weight.weight.length;R++)t.pages[f].url==tipuesearch_weight.weight[R].url&&(b+=tipuesearch_weight.weight[R].score);0!=b&&(found.push({score:b,title:t.pages[f].title,desc:L,url:t.pages[f].url}),_++)}if(0!=_){if(i.showTitleCount&&0==s){var T=document.title;document.title="("+_+") "+T,s++}if(o&&(h+='<div id="tipue_search_warning">'+tipuesearch_string_2+" "+d+". "+tipuesearch_string_3+' <a id="tipue_search_replaced">'+m+"</a></div>"),1==_?h+='<div id="tipue_search_results_count">'+tipuesearch_string_4:(c_c=_.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),h+='<div id="tipue_search_results_count">'+c_c+" "+tipuesearch_string_5),i.showTime)h+=" ("+(((new Date).getTime()-startTimer)/1e3).toFixed(2)+" "+tipuesearch_string_14+")",i.showTime=!1;h+="</div>",found.sort(function(e,t){return t.score-e.score});var k=0;for(f=0;f<found.length;f++){if(k>=a&&k<i.show+a){if(h+='<div class="tipue_search_content_title"><a href="'+found[f].url+'"'+r+">"+found[f].title+"</a></div>",i.debug&&(h+='<div class="tipue_search_content_debug">Score: '+found[f].score+"</div>"),i.showURL){var y=found[f].url.toLowerCase();0==y.indexOf("http://")&&(y=y.slice(7)),h+='<div class="tipue_search_content_url"><a href="'+found[f].url+'"'+r+">"+y+"</a></div>"}if(found[f].desc){var E=found[f].desc;if(i.showContext){g=d.split(" ");var W=found[f].desc.toLowerCase().indexOf(g[0]);if(W>i.contextStart){var O=E.substr(W-i.contextBuffer),S=O.indexOf(" ");O=E.substr(W-i.contextBuffer+S),(O=e.trim(O)).length>i.contextLength&&(E="... "+O)}}if(p){g=d.split(" ");for(w=0;w<g.length;w++)if(i.highlightTerms){var $=new RegExp("("+g[w]+")","gi");E=E.replace($,"<h0011>$1<h0012>")}}else if(i.highlightTerms){$=new RegExp("("+d+")","gi");E=E.replace($,'<span class="tipue_search_content_bold">$1</span>')}var j="",B=E.split(" ");if(B.length<i.descriptiveWords)j=E;else for(w=0;w<i.descriptiveWords;w++)j+=B[w]+" ";"."!=(j=e.trim(j)).charAt(j.length-1)&&(j+=" ..."),h+='<div class="tipue_search_content_text">'+(j=(j=j.replace(/h0011/g,'span class="tipue_search_content_bold"')).replace(/h0012/g,"/span"))+"</div>"}}k++}if(i.showRelated&&p){w=0;for(f=0;f<tipuesearch_related.searches.length;f++)d==tipuesearch_related.searches[f].search&&(o&&(u=d),w||(h+='<div class="tipue_search_related_title">'+tipuesearch_string_15+' <span class="tipue_search_related_bold">'+u+'</span></div><div class="tipue_search_related_cols">'),h+='<div class="tipue_search_related_text"><a class="tipue_search_related" id="'+tipuesearch_related.searches[f].related+'">',tipuesearch_related.searches[f].before&&(h+='<span class="tipue_search_related_before">'+tipuesearch_related.searches[f].before+"</span> "),h+=tipuesearch_related.searches[f].related,tipuesearch_related.searches[f].after&&(h+=' <span class="tipue_search_related_after">'+tipuesearch_related.searches[f].after+"</span>"),h+="</a></div>",w++);w&&(h+="</div>")}if(_>i.show){var D=Math.ceil(_/i.show),U=a/i.show;if(h+='<nav><div id="tipue_search_foot"><ul id="tipue_search_foot_boxes">',a>0&&(h+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="b" id="'+(a-i.show)+"_"+c+'">'+tipuesearch_string_6+"</a></li>"),U<=2){var q=D;D>3&&(q=3);for(w=0;w<q;w++)h+=w==U?'<li class="current" role="navigation">'+(w+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+w*i.show+"_"+c+'">'+(w+1)+"</a></li>"}else{(q=U+2)>D&&(q=D);for(w=U-1;w<q;w++)h+=w==U?'<li class="current" role="navigation">'+(w+1)+"</li>":'<li role="navigation"><a class="tipue_search_foot_box" id="'+w*i.show+"_"+c+'">'+(w+1)+"</a></li>"}U+1!=D&&(h+='<li role="navigation"><a class="tipue_search_foot_box" accesskey="m" id="'+(a+i.show)+"_"+c+'">'+tipuesearch_string_7+"</a></li>"),h+="</ul></div></nav>"}}else h+='<div id="tipue_search_warning">'+tipuesearch_string_8+"</div>"}else l?h+='<div id="tipue_search_warning">'+tipuesearch_string_8+". "+tipuesearch_string_9+"</div>":(h+='<div id="tipue_search_warning">'+tipuesearch_string_10+"</div>",1==i.minimumLength?h+='<div id="tipue_search_warning">'+tipuesearch_string_11+"</div>":h+='<div id="tipue_search_warning">'+tipuesearch_string_12+" "+i.minimumLength+" "+tipuesearch_string_13+"</div>");e("#tipue_search_content").hide().html(h).slideDown(200),e("#tipue_search_replaced").click(function(){n(0,!1)}),e(".tipue_search_related").click(function(){e("#tipue_search_input").val(e(this).attr("id")),n(0,!0)}),e(".tipue_search_foot_box").click(function(){var t=e(this).attr("id").split("_");n(parseInt(t[0]),t[1])})}i.newWindow&&(r=' target="_blank"'),c("q")&&(e("#tipue_search_input").val(c("q")),n(0,!0)),e(this).keyup(function(e){"13"==e.keyCode&&n(0,!0)})})}}(jQuery);